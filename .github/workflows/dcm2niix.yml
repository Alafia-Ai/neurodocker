# This is file is automatically generated. Do not edit.
name: 'dcm2niix'

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

on:
  push:
    branches: ["*"]
  pull_request:
    branches: ["*"]

# Uses the cron schedule for github actions
#
# https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#scheduled-events
#
#         ┌───────────── minute (0 - 59)
#         │ ┌───────────── hour (0 - 23)
#         │ │   ┌───────────── day of the month (1 - 31)
#         │ │   │    ┌───────────── month (1 - 12 or JAN-DEC)
#         │ │   │    │ ┌───────────── day of the week (0 - 6 or SUN-SAT)
#         │ │   │    │ │
#         │ │   │    │ │
#         │ │   │    │ │
#         * *   *    * *

  schedule:
  - cron: 0 0 1,15 * *

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:

  dcm2niix:

    runs-on: ubuntu-latest

    strategy:
      fail-fast: false
      matrix:
        base_image: ['ubuntu:22.04', 'ubuntu:18.04', 'ubuntu:16.04', 'debian:bullseye-slim', 'debian:buster-slim', 'debian:stretch-slim', 'fedora:36', 'centos:7']
        version: ['latest', 'v1.0.20201102', 'v1.0.20200331', 'v1.0.20190902']
        method: ['binaries', 'source']

    steps:
      - uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: "3.10"

      - name: Install neurodocker
        run: python -m pip install --editable .[dev]

      - name: Generate Dockerfile
        run: |

          apt_based=('ubuntu:22.04', 'ubuntu:18.04', 'ubuntu:16.04', 'debian:bullseye-slim', 'debian:buster-slim', 'debian:stretch-slim')
          if [[ " ${apt_based[*]} " =~ ${{ matrix.base_image }} ]]; then
            pkg_manager="apt"
          fi

          yum_based=('fedora:36', 'centos:7')
          if [[ " ${yum_based[*]} " =~ ${{ matrix.base_image }} ]]; then
            pkg_manager="yum"
          fi

          neurodocker \
            generate docker \
            --base-image=${{ matrix.base_image }} \
            --pkg-manager=${pkg_manager} \
            --yes \
            --dcm2niix \
            version=${{ matrix.version }} \
            method=${{ matrix.method }} \
            > Dockerfile_tmp

          cat Dockerfile_tmp

      - name: Build the Docker image
        run: docker build -f Dockerfile_tmp .
