name: bootstrap

on:
  push:
    branches: [ "*" ] 
  pull_request:
    branches: [ "*" ]

jobs:
  bootstrap:
    runs-on: ubuntu-22.04

    steps:
      - uses: actions/checkout@v2
        with:
          token: ${{ secrets.BOOTSTRAP }}

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: python -m pip install jinja2 pyyaml

      - name: Create workflows
        run: |
          python .github/workflows/create_workflows.py
          ls -l .github/workflows

      # https://github.com/actions/checkout#push-a-commit-using-the-built-in-token
      - run: |
          git config user.name github-actions
          git config user.email github-actions@github.com
          git checkout -b test_docker_build
          git add .
          git commit -m "add workflows"
          git push --set-upstream origin test_docker_build         

      - uses: stefanzweifel/git-auto-commit-action@v4
        with:
          # Optional. Commit message for the created commit.
          # Defaults to "Apply automatic changes"
          commit_message: add workflows

          # Optional. Local and remote branch name where commit is going to be pushed
          #  to. Defaults to the current branch.
          #  You might need to set `create_branch: true` if the branch does not exist.
          branch: test_docker_build

          # Optional. Options used by `git-commit`.
          # See https://git-scm.com/docs/git-commit#_options
          commit_options: '--no-verify --signoff'

          # https://github.com/actions/checkout#push-a-commit-using-the-built-in-token
          commit_user_name: github-actions 
          commit_user_email: github-actions@github.com 

          # Optional. Options used by `git-push`.
          # See https://git-scm.com/docs/git-push#_options
          push_options: '--force'
          
          # Optional. Disable dirty check and always try to create a commit and push
          skip_dirty_check: true    
          
          # Optional. Skip internal call to `git fetch`
          skip_fetch: true    
          
          # Optional. Skip internal call to `git checkout`
          skip_checkout: true

          # Optional. Create given branch name in local and remote repository.
          create_branch: true


